# 租金提醒系统技术文档

## 1. 系统架构设计

### 1.1 架构概述
- **架构类型**: 简单单体应用 (Node.js + Express)
- **组件划分**:
  - API层: 处理HTTP请求
  - 服务层: 业务逻辑处理
  - 数据层: SQLite数据库交互
  - 工具层: 辅助功能（JWT、配置等）

### 1.2 技术栈选择

| 分类 | 技术/框架 | 版本 | 选型理由 |
|------|----------|------|----------|
| **后端语言** | Node.js | 18.x+ | 轻量、高性能、非阻塞IO、生态成熟 |
| **Web框架** | Express | 4.x | 轻量、灵活、中间件丰富、学习曲线平缓 |
| **数据库** | SQLite | 3.x | 嵌入式数据库、无需安装、文件存储、适合小型应用 |
| **认证** | JWT | - | 无状态认证、便于水平扩展 |
| **配置管理** | dotenv | - | 环境变量管理、简化配置 |

## 2. 数据库结构设计

### 2.1 数据模型

#### 2.1.1 `tenants` 表（租户信息）
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| `id` | `INTEGER` | `PRIMARY KEY AUTOINCREMENT` | 租户ID |
| `name` | `VARCHAR(100)` | `NOT NULL` | 租户姓名 |
| `phone` | `VARCHAR(20)` | `NOT NULL` | 手机号码 |
| `email` | `VARCHAR(255)` | `NOT NULL` | 邮箱地址 |
| `leaseStartDate` | `DATE` | `NOT NULL` | 租约开始日期 |
| `leaseEndDate` | `DATE` | `NOT NULL` | 租约结束日期 |
| `rentAmount` | `DECIMAL(10,2)` | `NOT NULL` | 租金金额 |
| `createdAt` | `TIMESTAMP` | `DEFAULT CURRENT_TIMESTAMP` | 创建时间 |
| `updatedAt` | `TIMESTAMP` | `DEFAULT CURRENT_TIMESTAMP` | 更新时间 |

#### 2.1.2 `reminders` 表（提醒记录）
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| `id` | `INTEGER` | `PRIMARY KEY AUTOINCREMENT` | 提醒记录ID |
| `tenantId` | `INTEGER` | `REFERENCES tenants(id)` | 租户ID |
| `content` | `TEXT` | `NOT NULL` | 提醒内容 |
| `status` | `VARCHAR(20)` | `NOT NULL DEFAULT 'pending'` | 状态: pending, sent, failed |
| `sendTime` | `TIMESTAMP` | `NULL` | 发送时间 |
| `failureReason` | `TEXT` | `NULL` | 失败原因 |
| `createdAt` | `TIMESTAMP` | `DEFAULT CURRENT_TIMESTAMP` | 创建时间 |

#### 2.1.3 `users` 表（管理员用户）
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| `id` | `INTEGER` | `PRIMARY KEY AUTOINCREMENT` | 用户ID |
| `username` | `VARCHAR(50)` | `NOT NULL UNIQUE` | 用户名 |
| `passwordHash` | `VARCHAR(255)` | `NOT NULL` | 密码哈希 |
| `createdAt` | `TIMESTAMP` | `DEFAULT CURRENT_TIMESTAMP` | 创建时间 |

## 3. 关键模块设计

### 3.1 认证模块
- **功能**: 用户登录、JWT生成与验证
- **安全措施**: 密码哈希存储、JWT过期控制

### 3.2 租户管理模块
- **功能**: 租户信息的增删改查
- **数据验证**: 输入校验、邮箱/手机号格式验证

### 3.3 提醒管理模块
- **功能**: 触发提醒、记录状态、查询历史
- **消息生成**: 模板化消息内容生成

## 4. API设计

### 4.1 认证接口
- **POST /api/auth/login** - 用户登录

### 4.2 租户管理接口
- **POST /api/tenants** - 创建租户
- **GET /api/tenants** - 获取租户列表
- **GET /api/tenants/:id** - 获取单个租户详情
- **PUT /api/tenants/:id** - 更新租户信息

### 4.3 提醒管理接口
- **POST /api/reminders** - 触发提醒
- **GET /api/reminders** - 获取提醒记录

## 5. 安全考量

### 5.1 数据安全
- 密码使用bcrypt哈希存储
- 敏感信息不记录到日志

### 5.2 API安全
- JWT认证保护API
- 请求频率限制
- 输入数据验证

## 6. 部署与运行

### 6.1 环境要求
- Node.js 18.x+
- SQLite 3.x（无需单独安装）

### 6.2 安装步骤
1. 克隆代码库
2. 安装依赖: `npm install`
3. 配置环境变量（创建.env文件）
4. 启动应用: `npm start`

### 6.3 目录结构
```
backend/
  ├── index.js              # 应用入口
  ├── db.js                 # 数据库连接和初始化
  ├── controllers/          # 控制器
  │   ├── authController.js
  │   ├── tenantController.js
  │   └── reminderController.js
  ├── routes/               # 路由
  │   ├── authRoutes.js
  │   ├── tenantRoutes.js
  │   └── reminderRoutes.js
  ├── middleware/           # 中间件
  │   └── authMiddleware.js
  ├── utils/                # 工具函数
  │   └── jwtUtils.js
  ├── .env                  # 环境变量
  ├── package.json
  └── README.md
```